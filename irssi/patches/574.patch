From 4cbf279d88248d600d22b8cff474a9dc4a455b31 Mon Sep 17 00:00:00 2001
From: Lauri Tirkkonen <lotheac@iki.fi>
Date: Tue, 8 Nov 2016 16:27:38 +0200
Subject: [PATCH] add completion_empty_line setting

---
 src/fe-common/core/chat-completion.c | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/src/fe-common/core/chat-completion.c b/src/fe-common/core/chat-completion.c
index 3e14460..1f00fea 100644
--- a/src/fe-common/core/chat-completion.c
+++ b/src/fe-common/core/chat-completion.c
@@ -48,6 +48,6 @@ static int keep_privates_count, keep_publics_count;
 static int completion_lowercase;
 static char *completion_char, *cmdchars;
 static GSList *global_lastmsgs;
-static int completion_auto, completion_strict;
+static int completion_auto, completion_strict, completion_empty_line;
 
 #define SERVER_LAST_MSG_ADD(server, nick) \
@@ -669,6 +669,8 @@ static void sig_complete_word(GList **list, WINDOW_REC *window,
 		return;
 
 	if (*linestart == '\0' && *word == '\0') {
+		if (!completion_empty_line)
+			return;
 		/* pressed TAB at the start of line - add /MSG */
                 prefix = g_strdup_printf("%cmsg", *cmdchars);
 		*list = completion_msg(server, NULL, "", prefix);
@@ -1157,6 +1159,7 @@ static void read_settings(void)
 
 	completion_auto = settings_get_bool("completion_auto");
 	completion_strict = settings_get_bool("completion_strict");
+	completion_empty_line = settings_get_bool("completion_empty_line");
 
 	completion_match_case = settings_get_choice("completion_nicks_match_case");
 
@@ -1180,5 +1183,6 @@ void chat_completion_init(void)
 	settings_add_int("completion", "completion_keep_privates", 10);
 	settings_add_bool("completion", "completion_nicks_lowercase", FALSE);
 	settings_add_bool("completion", "completion_strict", FALSE);
+	settings_add_bool("completion", "completion_empty_line", TRUE);
 
 	settings_add_bool("lookandfeel", "expand_escapes", FALSE);
